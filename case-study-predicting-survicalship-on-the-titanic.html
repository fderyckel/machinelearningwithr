<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Machine Learning with R</title>
  <meta name="description" content="This book is about using R for machine learning purposes.">
  <meta name="generator" content="bookdown 0.3.9 and GitBook 2.6.7">

  <meta property="og:title" content="Machine Learning with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is about using R for machine learning purposes." />
  <meta name="github-repo" content="fderyckel/machinelearningwithr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Machine Learning with R" />
  
  <meta name="twitter:description" content="This book is about using R for machine learning purposes." />
  

<meta name="author" content="FranÃ§ois de Ryckel">


<meta name="date" content="2017-03-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="case-study-mushrooms-classification.html">
<link rel="next" href="final-words.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Machine Learning with R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="literature.html"><a href="literature.html"><i class="fa fa-check"></i><b>3</b> Literature</a></li>
<li class="chapter" data-level="4" data-path="trees-and-classification.html"><a href="trees-and-classification.html"><i class="fa fa-check"></i><b>4</b> Trees and Classification</a><ul>
<li class="chapter" data-level="4.1" data-path="trees-and-classification.html"><a href="trees-and-classification.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="trees-and-classification.html"><a href="trees-and-classification.html#first-example."><i class="fa fa-check"></i><b>4.2</b> First example.</a></li>
<li class="chapter" data-level="4.3" data-path="trees-and-classification.html"><a href="trees-and-classification.html#second-example."><i class="fa fa-check"></i><b>4.3</b> Second Example.</a></li>
<li class="chapter" data-level="4.4" data-path="trees-and-classification.html"><a href="trees-and-classification.html#how-does-a-tree-decide-where-to-split"><i class="fa fa-check"></i><b>4.4</b> How does a tree decide where to split?</a></li>
<li class="chapter" data-level="4.5" data-path="trees-and-classification.html"><a href="trees-and-classification.html#third-example."><i class="fa fa-check"></i><b>4.5</b> Third example.</a></li>
<li class="chapter" data-level="4.6" data-path="trees-and-classification.html"><a href="trees-and-classification.html#references"><i class="fa fa-check"></i><b>4.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i><b>5</b> Principal Component Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#pca-on-an-easy-example."><i class="fa fa-check"></i><b>5.1</b> PCA on an easy example.</a></li>
<li class="chapter" data-level="5.2" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#attempt-of-pca-on-technical-indicators."><i class="fa fa-check"></i><b>5.2</b> Attempt of PCA on technical indicators.</a></li>
<li class="chapter" data-level="5.3" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#doing-pca-and-pcr-with-the-pls-package"><i class="fa fa-check"></i><b>5.3</b> Doing PCA and PCR with the PLS package</a></li>
<li class="chapter" data-level="5.4" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#references."><i class="fa fa-check"></i><b>5.4</b> References.</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html"><i class="fa fa-check"></i><b>6</b> Case Study - Mushrooms Classification</a><ul>
<li class="chapter" data-level="6.1" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#import-the-data"><i class="fa fa-check"></i><b>6.1</b> Import the data</a></li>
<li class="chapter" data-level="6.2" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#tidy-the-data"><i class="fa fa-check"></i><b>6.2</b> Tidy the data</a></li>
<li class="chapter" data-level="6.3" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#understand-the-data"><i class="fa fa-check"></i><b>6.3</b> Understand the data</a><ul>
<li class="chapter" data-level="6.3.1" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#a.-transform-the-data"><i class="fa fa-check"></i><b>6.3.1</b> A. Transform the data</a></li>
<li class="chapter" data-level="6.3.2" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#a.-visualize-the-data"><i class="fa fa-check"></i><b>6.3.2</b> A. Visualize the data</a></li>
<li class="chapter" data-level="6.3.3" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#a.-modeling"><i class="fa fa-check"></i><b>6.3.3</b> A. Modeling</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#communication"><i class="fa fa-check"></i><b>6.4</b> Communication</a></li>
<li class="chapter" data-level="6.5" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#example-one"><i class="fa fa-check"></i><b>6.5</b> Example one</a></li>
<li class="chapter" data-level="6.6" data-path="case-study-mushrooms-classification.html"><a href="case-study-mushrooms-classification.html#example-two"><i class="fa fa-check"></i><b>6.6</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html"><i class="fa fa-check"></i><b>7</b> Case Study - Predicting Survicalship on the Titanic</a><ul>
<li class="chapter" data-level="7.1" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#import-the-data."><i class="fa fa-check"></i><b>7.1</b> Import the data.</a></li>
<li class="chapter" data-level="7.2" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#tidy-the-data-1"><i class="fa fa-check"></i><b>7.2</b> Tidy the data</a></li>
<li class="chapter" data-level="7.3" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#understand-the-data-1"><i class="fa fa-check"></i><b>7.3</b> Understand the data</a><ul>
<li class="chapter" data-level="7.3.1" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#a.-transform-the-data-1"><i class="fa fa-check"></i><b>7.3.1</b> A. Transform the data</a></li>
<li class="chapter" data-level="7.3.2" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#a.-vizualize-with-families."><i class="fa fa-check"></i><b>7.3.2</b> A. Vizualize with families.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#a.-visualize-with-cabins."><i class="fa fa-check"></i><b>7.4</b> A. Visualize with cabins.</a></li>
<li class="chapter" data-level="7.5" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#b.-transform-dealing-with-missing-data."><i class="fa fa-check"></i><b>7.5</b> B. Transform Dealing with missing data.</a><ul>
<li class="chapter" data-level="7.5.1" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#overview."><i class="fa fa-check"></i><b>7.5.1</b> Overview.</a></li>
<li class="chapter" data-level="7.5.2" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#c.-transform-more-feature-engineering-with-the-ages-and-others."><i class="fa fa-check"></i><b>7.5.2</b> C. Transform More feature engineering with the ages and others.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="case-study-predicting-survicalship-on-the-titanic.html"><a href="case-study-predicting-survicalship-on-the-titanic.html#references.-1"><i class="fa fa-check"></i><b>7.6</b> References.</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>8</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="case-study---predicting-survicalship-on-the-titanic" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Case Study - Predicting Survicalship on the Titanic</h1>
<p>This chapter demonstrates another example of classification with machine learning. Kaggle made this exercise quite popular.</p>
<p>In this study, the training and test sets have already been defined, so we</p>
<div id="import-the-data." class="section level2">
<h2><span class="header-section-number">7.1</span> Import the data.</h2>
<p>We have put our data into our google drive <a href="https://drive.google.com/open?id=0ByHtvgo2NGDMV2VBWklMNFpVaVE">here</a> and <a href="https://drive.google.com/open?id=0ByHtvgo2NGDMaFByZWRxVEJSeDg">here</a>. You can find them on Kaggle if need be.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)

train_set &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;~/Google Drive/Software/R projects/datasets/Kaggle_Titanic_train.csv&quot;</span>)
test_set &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;~/Google Drive/Software/R projects/datasets/Kaggle_Titanic_test.csv&quot;</span>)  

## Let&#39;s bind both set of data for our exploratory analysis.
mydata &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(train_set, test_set)  

## Let&#39;s have a first glimpse to our data
<span class="kw">glimpse</span>(mydata)</code></pre></div>
<pre><code>## Observations: 1,309
## Variables: 12
## $ PassengerId &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,...
## $ Survived    &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0,...
## $ Pclass      &lt;int&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3,...
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bra...
## $ Sex         &lt;chr&gt; &quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;, &quot;mal...
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, ...
## $ SibSp       &lt;int&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4,...
## $ Parch       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1,...
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;1138...
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, ...
## $ Cabin       &lt;chr&gt; NA, &quot;C85&quot;, NA, &quot;C123&quot;, NA, NA, &quot;E46&quot;, NA, NA, NA, ...
## $ Embarked    &lt;chr&gt; &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;C&quot;, ...</code></pre>
</div>
<div id="tidy-the-data-1" class="section level2">
<h2><span class="header-section-number">7.2</span> Tidy the data</h2>
<p>One can already see that we should put <code>Survived</code>, <code>Sex</code> and <code>Embarked</code> as factor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$Survived &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$Survived)
mydata$Sex &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$Sex)
mydata$Embarked &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$Embarked)</code></pre></div>
</div>
<div id="understand-the-data-1" class="section level2">
<h2><span class="header-section-number">7.3</span> Understand the data</h2>
<p>This step consists in massaging our variables to see if we can construct new ones or create additional meaning from what we have. This step require some additional knowledge related to the data and getting familiar with the topics at hand.</p>
<div id="a.-transform-the-data-1" class="section level3">
<h3><span class="header-section-number">7.3.1</span> A. Transform the data</h3>
<p>The great thing about this data set is all the features engineering one can do to increase the predictibilty power of our model.</p>
<div id="dealing-with-names." class="section level4">
<h4><span class="header-section-number">7.3.1.1</span> Dealing with names.</h4>
<p>One of the thing one can notice is the title associated with the name. The full names on their own might have little predictibility power, but the <em>title</em> in the name might have some value and can be used as an additional variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(mydata$Name)  </code></pre></div>
<pre><code>##  chr [1:1309] &quot;Braund, Mr. Owen Harris&quot; ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## gsub is never fun to use.  But we need to strip the cell up to the comma, 
## then everything after the point of the title.
mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;(.*,)|(</span><span class="ch">\\</span><span class="st">..*)&#39;</span>, <span class="st">&quot;&quot;</span>, mydata$Name)
<span class="kw">table</span>(mydata$Sex,mydata$title)</code></pre></div>
<pre><code>##         
##           Capt  Col  Don  Dona  Dr  Jonkheer  Lady  Major  Master  Miss
##   female     0    0    0     1   1         0     1      0       0   260
##   male       1    4    1     0   7         1     0      2      61     0
##         
##           Mlle  Mme  Mr  Mrs  Ms  Rev  Sir  the Countess
##   female     2    1   0  197   2    0    0             1
##   male       0    0 757    0   0    8    1             0</code></pre>
<p>Some titles are just translations from other languages. Letâs regroup those. Some other titles arenât occuring often and would not justify to have a category on their own. We have regroup some titles under common category. There is some arbitraire in here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Mlle&quot;</span>, <span class="st">&quot;Miss&quot;</span>, mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Mme&quot;</span>, <span class="st">&quot;Mrs&quot;</span>, mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Ms&quot;</span>, <span class="st">&quot;Miss&quot;</span>, mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Jonkheer&quot;</span>, <span class="st">&quot;Mr&quot;</span>, mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Capt|Col|Major&quot;</span>, <span class="st">&quot;Army&quot;</span>, mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Don|Dona|Lady|Sir|the Countess&quot;</span>, <span class="st">&quot;Nobility&quot;</span>, mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Dr|Rev&quot;</span>, <span class="st">&quot;Others&quot;</span>, mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$title)
mydata$title &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$title, 
                  <span class="kw">levels</span>(mydata$title)[<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">6</span>)] )
<span class="kw">table</span>(mydata$Sex, mydata$title)</code></pre></div>
<pre><code>##         
##           Mrs  Miss  Master  Mr  Others  Army  Nobility
##   female  198   264       0   0       1     0         3
##   male      0     0      61 758      15     7         2</code></pre>
<p>It would be also interesting in fact to check the proportion of survivors for each type of title.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(mydata$Survived, mydata$title), <span class="dv">2</span>), <span class="dv">2</span>)</code></pre></div>
<pre><code>##    
##      Mrs  Miss  Master   Mr  Others  Army  Nobility
##   0 0.21  0.30    0.42 0.84    0.77  0.60      0.25
##   1 0.79  0.70    0.57 0.16    0.23  0.40      0.75</code></pre>
<p>We can notice that <code>Mrs</code> are more likely to survive than <code>Miss</code>. As expected, our <code>Mr</code> have a very low likelyhood of success. Our <code>Noble</code> title managed mostly to survive.</p>
<p>Our next step is to create a <code>Last_Name</code> variable. This could be helpful as the ways family have escaped the boat might hold some pattens.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## To get the last name we strip everything after the first comma.    
mydata$last_name &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;,.*&quot;</span>, <span class="st">&quot;&quot;</span>, mydata$Name)  

## We can now put this as factor and check how many families.   
mydata$last_name &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$last_name)</code></pre></div>
<p>So we have 875 different families on board of the Titanic. Of course, there might have different families with the same last name. If thatâs the case, we wonât know.</p>
</div>
</div>
<div id="a.-vizualize-with-families." class="section level3">
<h3><span class="header-section-number">7.3.2</span> A. Vizualize with families.</h3>
<p>We could add a variable about the family size.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$family_size &lt;-<span class="st"> </span>mydata$SibSp +<span class="st"> </span>mydata$Parch +<span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>If we plot that to check survivalship in function of family size, one can notice interesting patterns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mydata[<span class="dv">1</span>:<span class="dv">891</span>,]
<span class="kw">ggplot</span>(x, <span class="kw">aes</span>(<span class="dt">x =</span> family_size, <span class="dt">fill =</span> <span class="kw">factor</span>(Survived))) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;count&#39;</span>, <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">11</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Family Size&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Survived&quot;</span>, 
       <span class="dt">title =</span> <span class="st">&quot;Survivalship by Family Size&quot;</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.9</span>, <span class="fl">0.8</span>), <span class="dt">panel.background =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_survical_family_pic1-1.png" width="672" /></p>
<p>Obviously, we only have the survivalship for the train set of data, as we have to guess the test set of data. So from what we have, there is a clear advantage in being a family of 2, 3 or 4. We could collapse the variable <code>Family_Size</code> into 3 levels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$family_size_type[mydata$family_size ==<span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> &quot;Singleton&quot;</span>
mydata$family_size_type[mydata$family_size &lt;=<span class="st"> </span><span class="dv">4</span> &amp;<span class="st"> </span>mydata$family_size &gt;<span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> &quot;Small&quot;</span>
mydata$family_size_type[mydata$family_size &gt;<span class="st"> </span><span class="dv">4</span>] &lt;-<span class="st"> &quot;Large&quot;</span>
mydata$family_size_type &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$family_size_type, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Singleton&quot;</span>, <span class="st">&quot;Small&quot;</span>, <span class="st">&quot;Large&quot;</span>))</code></pre></div>
<p>We can see how many people in each category, then we plot the proportion of survivers in each category.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mydata[<span class="dv">1</span>:<span class="dv">891</span>,]
<span class="kw">table</span>(x$Survived, x$family_size_type)</code></pre></div>
<pre><code>##    
##     Singleton Small Large
##   0       374   123    52
##   1       163   169    10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggmosaic)
<span class="kw">ggplot</span>(<span class="dt">data =</span> x) +<span class="st"> </span><span class="kw">geom_mosaic</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">product</span>(family_size_type), <span class="dt">fill =</span> Survived)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Family Size&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Proportion&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_survival_family_pic2-1.png" width="672" /></p>
<p>Clearly, there is an advantage in being in a family of size 2, 3 or 4; while there is a disadventage in being part of of a bigger family.</p>
<p>We can try to digg in a bit further with our new family size and titles. For people who are part of a <em>Small</em> family size, which <em>title</em> are more likely to surived?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>x %&gt;%<span class="st"> </span>dplyr::<span class="kw">filter</span>(family_size_type ==<span class="st"> &quot;Small&quot;</span>)
<span class="kw">table</span>(y$Survived, y$title)</code></pre></div>
<pre><code>##    
##      Mrs  Miss  Master  Mr  Others  Army  Nobility
##   0   17    13       0  89       3     1         0
##   1   78    46      22  20       1     0         2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> y) +<span class="st"> </span><span class="kw">geom_mosaic</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">product</span>(title), <span class="dt">fill =</span> Survived)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Survivorship for Small Families in function of their title&quot;</span>, 
       <span class="dt">y =</span> <span class="st">&quot;Proportion&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="ot">NULL</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">vjust=</span><span class="dv">1</span>))</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_survical_title_pic1-1.png" width="672" /></p>
<p>All masters in small families have survived. Miss &amp; Mrs in small family size have also lots of chane of survival.</p>
<p>Similarly, for people who embarked alone (<em>Singleton</em>), which <em>title</em> are more likely to surived?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>x %&gt;%<span class="st"> </span><span class="kw">filter</span>(family_size_type ==<span class="st"> &quot;Singleton&quot;</span>)
<span class="kw">table</span>(y$Survived, y$title)</code></pre></div>
<pre><code>##    
##      Mrs  Miss  Master  Mr  Others  Army  Nobility
##   0    2    25       0 337       7     2         1
##   1   19    78       0  61       2     2         1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> y) +<span class="st"> </span><span class="kw">geom_mosaic</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">product</span>(title), <span class="dt">fill =</span> Survived)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Survivorship for people who boarded alone in function of their title&quot;</span>, 
       <span class="dt">y =</span> <span class="st">&quot;Proportion&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="ot">NULL</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">vjust=</span><span class="dv">1</span>))</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_survival_title_pic2-1.png" width="672" /></p>
<p>It might not comes as clear, but we could do the same for title and gender. Vertically the stacks are ordered as <code>Singleton</code> then <code>Small</code> then <code>Large</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> x) +<span class="st"> </span><span class="kw">geom_mosaic</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">product</span>(family_size_type, title), <span class="dt">fill =</span> Survived)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Survivorship in function of family type and title summary&quot;</span>, 
       <span class="dt">y =</span> <span class="st">&quot;Proportion&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="ot">NULL</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">vjust=</span><span class="dv">1</span>))</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_survival_title_pic3-1.png" width="672" /></p>
</div>
</div>
<div id="a.-visualize-with-cabins." class="section level2">
<h2><span class="header-section-number">7.4</span> A. Visualize with cabins.</h2>
<p>Although there are many missing data there, we can use the cabin number given to passengers. The first letter of the cabin number correspond to the deck on the boat. So letâs strip that deck location from the cabin number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x$deck &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;([A-Z]+).*&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&quot;</span>, x$Cabin)
y &lt;-<span class="st"> </span>x %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(deck))

<span class="kw">table</span>(x$Survived, x$deck)</code></pre></div>
<pre><code>##    
##      A  B  C  D  E  F  G  T
##   0  8 12 24  8  8  5  2  1
##   1  7 35 35 25 24  8  2  0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> y) +<span class="st"> </span><span class="kw">geom_mosaic</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">product</span>(deck), <span class="dt">fill =</span> Survived)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Survivorship in function of Deck Location&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Proportion&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="ot">NULL</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">vjust=</span><span class="dv">1</span>))</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_survival_class_pic1-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(<span class="st">&quot;package:ggmosaic&quot;</span>, <span class="dt">unload=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>There is a bit of an anomaly here as it almost as if most people survived. Now letâs keep in mind, that this is only for people which we have their cabin data.</p>
<p>Letâs have a look at how the <code>Passenger Class</code> are distributed on the decks. As we are also finishing this first round of feature engineering, letâs just mention also how the Passenger Class is affecting survivalship.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(x$Pclass, x$deck)</code></pre></div>
<pre><code>##    
##      A  B  C  D  E  F  G  T
##   1 15 47 59 29 25  0  0  1
##   2  0  0  0  4  4  8  0  0
##   3  0  0  0  0  3  5  4  0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(x$Survived, x$Pclass), <span class="dv">2</span>), <span class="dv">2</span>)</code></pre></div>
<pre><code>##    
##        1    2    3
##   0 0.37 0.53 0.76
##   1 0.63 0.47 0.24</code></pre>
<p>More first class people have survived than other classes.</p>
</div>
<div id="b.-transform-dealing-with-missing-data." class="section level2">
<h2><span class="header-section-number">7.5</span> B. Transform Dealing with missing data.</h2>
<div id="overview." class="section level3">
<h3><span class="header-section-number">7.5.1</span> Overview.</h3>
<p>I found this very cool package called <code>visdat</code> based on <code>ggplot2</code> that help us visualize easily missing data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">visdat::<span class="kw">vis_dat</span>(mydata)</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_missingdata_pic1-1.png" width="672" /> Straight away one can see that the variables <code>cabin</code> and and <code>Age</code> have quite a lot of missing data.<br />
For more accuracy one could check</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fun1 &lt;-<span class="st"> </span>function(x){<span class="kw">sum</span>(<span class="kw">is.na</span>(x))}
<span class="kw">map_dbl</span>(mydata, fun1)</code></pre></div>
<pre><code>##      PassengerId         Survived           Pclass             Name 
##                0              418                0                0 
##              Sex              Age            SibSp            Parch 
##                0              263                0                0 
##           Ticket             Fare            Cabin         Embarked 
##                0                1             1014                2 
##            title        last_name      family_size family_size_type 
##                0                0                0                0</code></pre>
<p>So we can see some missing data in <code>Fare</code> and in <code>Embarked</code> as well.<br />
Letâs deal with these last 2 variables first.</p>
<div id="basic-replacement." class="section level4">
<h4><span class="header-section-number">7.5.1.1</span> Basic Replacement.</h4>
<p>We first start with the dessert and the variables that have few missing data. For those, one can take the median of similar data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(mydata$Embarked))
<span class="kw">glimpse</span>(mydata[y, ])</code></pre></div>
<pre><code>## Observations: 2
## Variables: 16
## $ PassengerId      &lt;int&gt; 62, 830
## $ Survived         &lt;fctr&gt; 1, 1
## $ Pclass           &lt;int&gt; 1, 1
## $ Name             &lt;chr&gt; &quot;Icard, Miss. Amelie&quot;, &quot;Stone, Mrs. George Ne...
## $ Sex              &lt;fctr&gt; female, female
## $ Age              &lt;dbl&gt; 38, 62
## $ SibSp            &lt;int&gt; 0, 0
## $ Parch            &lt;int&gt; 0, 0
## $ Ticket           &lt;chr&gt; &quot;113572&quot;, &quot;113572&quot;
## $ Fare             &lt;dbl&gt; 80, 80
## $ Cabin            &lt;chr&gt; &quot;B28&quot;, &quot;B28&quot;
## $ Embarked         &lt;fctr&gt; NA, NA
## $ title            &lt;fctr&gt;  Miss,  Mrs
## $ last_name        &lt;fctr&gt; Icard, Stone
## $ family_size      &lt;dbl&gt; 1, 1
## $ family_size_type &lt;fctr&gt; Singleton, Singleton</code></pre>
<p>So the 2 passengers that have no data on the origin of their embarqument are 2 ladies that boarded alone and that shared the same room in first class and that paid $80.</p>
<p>Letâs see who might have paid $80 for a fare.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>mydata %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(Embarked))
<span class="kw">ggplot</span>(y, <span class="kw">aes</span>(<span class="dt">x =</span> Embarked, <span class="dt">y =</span> Fare, <span class="dt">fill =</span> <span class="kw">factor</span>(Pclass))) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales::dollar, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">250</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Passenger </span><span class="ch">\n</span><span class="st"> Class&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">80</span>), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">lwd =</span> <span class="dv">1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.9</span>, <span class="fl">0.8</span>), <span class="dt">panel.background =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_missingdata_pic2-1.png" width="672" /></p>
<p>Following this graph, the 2 passengers without origin of embarcation are most likely from âCâ. That said, one can argue that the 2 ladies should have embarked from âSâ as this is where most people embarked as shown in this table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(mydata$Embarked)</code></pre></div>
<pre><code>## 
##   C   Q   S 
## 270 123 914</code></pre>
<p>That said, if we filter our data for the demographics of these 2 ladies, the likelhood of coming from âSâ decreased quite a bit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mydata %&gt;%<span class="st"> </span><span class="kw">filter</span>(Sex ==<span class="st"> &quot;female&quot;</span>, Pclass ==<span class="st"> </span><span class="dv">1</span>, family_size ==<span class="st"> </span><span class="dv">1</span>)
<span class="kw">table</span>(x$Embarked)</code></pre></div>
<pre><code>## 
##  C  Q  S 
## 30  0 20</code></pre>
<p>So if we go with median price and with the demographics of the ladies, it would be more likely that they come from âCâ. So letâs input that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$Embarked[<span class="kw">c</span>(<span class="dv">62</span>, <span class="dv">830</span>)] &lt;-<span class="st"> &quot;C&quot;</span></code></pre></div>
<p>Now onto that missing <code>Fare</code> data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(mydata$Fare))
<span class="kw">glimpse</span>(mydata[y, ])</code></pre></div>
<pre><code>## Observations: 1
## Variables: 16
## $ PassengerId      &lt;int&gt; 1044
## $ Survived         &lt;fctr&gt; NA
## $ Pclass           &lt;int&gt; 3
## $ Name             &lt;chr&gt; &quot;Storey, Mr. Thomas&quot;
## $ Sex              &lt;fctr&gt; male
## $ Age              &lt;dbl&gt; 60.5
## $ SibSp            &lt;int&gt; 0
## $ Parch            &lt;int&gt; 0
## $ Ticket           &lt;chr&gt; &quot;3701&quot;
## $ Fare             &lt;dbl&gt; NA
## $ Cabin            &lt;chr&gt; NA
## $ Embarked         &lt;fctr&gt; S
## $ title            &lt;fctr&gt;  Mr
## $ last_name        &lt;fctr&gt; Storey
## $ family_size      &lt;dbl&gt; 1
## $ family_size_type &lt;fctr&gt; Singleton</code></pre>
<p>That passenger is a male that boarded in Southampton in third class. So letâs take the median price for similar passagers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>mydata %&gt;%<span class="st"> </span><span class="kw">filter</span>(Embarked ==<span class="st"> &quot;S&quot;</span> &amp;<span class="st"> </span>Pclass ==<span class="st"> &quot;3&quot;</span> &amp;<span class="st"> </span>Sex ==<span class="st"> &quot;male&quot;</span> &amp;<span class="st"> </span>
<span class="st">                         </span>family_size ==<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>Age &gt;<span class="st"> </span><span class="dv">40</span>)
<span class="kw">median</span>(y$Fare, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 7.8521</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$Fare[<span class="dv">1044</span>] &lt;-<span class="st"> </span><span class="kw">median</span>(y$Fare, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="predictive-modeling-replacement." class="section level4">
<h4><span class="header-section-number">7.5.1.2</span> Predictive modeling replacement.</h4>
<p>First, weâll focus on the <code>Age</code> variable.<br />
There are several methods to input missing data. Weâll try 2 different ones in here.<br />
But before we can go forward, we have to factorise some variables.<br />
Letâs do the same with <code>Sibsp</code> and <code>Parch</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$Pclass &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$Pclass)</code></pre></div>
<p>The first method weâll be using is with the <code>missForest</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>mydata %&gt;%<span class="st"> </span><span class="kw">select</span>(Pclass, Sex, Fare, Embarked, title, family_size, SibSp, Parch, Age)
y &lt;-<span class="st"> </span><span class="kw">data.frame</span>(y)

<span class="kw">library</span>(missForest)
z1 &lt;-<span class="st"> </span><span class="kw">missForest</span>(y, <span class="dt">maxiter =</span> <span class="dv">50</span>, <span class="dt">ntree =</span> <span class="dv">500</span>)
z1 &lt;-<span class="st"> </span>z1[[<span class="dv">1</span>]]

<span class="co"># To view the new ages</span>
<span class="co"># View(z1[[1]])</span>

<span class="kw">detach</span>(<span class="st">&quot;package:missForest&quot;</span>, <span class="dt">unload=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>The process is fairly rapid on my computer (around 10~15 seconds)</p>
<p>Our second method takes slightly more time.<br />
This time we are using the <code>mice</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>mydata %&gt;%<span class="st"> </span><span class="kw">select</span>(Pclass, Sex, Fare, Embarked, title, family_size, SibSp, Parch, Age)
y$Pclass &lt;-<span class="st"> </span><span class="kw">factor</span>(y$Pclass)
y$family_size &lt;-<span class="st"> </span><span class="kw">factor</span>(y$family_size)
y &lt;-<span class="st"> </span><span class="kw">data.frame</span>(y)

<span class="kw">library</span>(mice)
mice_mod &lt;-<span class="st"> </span><span class="kw">mice</span>(y, <span class="dt">method =</span> <span class="st">&#39;rf&#39;</span>)
z2 &lt;-<span class="st"> </span><span class="kw">complete</span>(mice_mod)

<span class="co"># To view the new ages</span>
<span class="co">#View(z2[[1]])</span>

<span class="kw">detach</span>(<span class="st">&quot;package:mice&quot;</span>, <span class="dt">unload=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>letâs compare both type of imputations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mydata, <span class="kw">aes</span>(<span class="dt">x =</span> mydata$Age)) +<span class="st"> </span>
<span class="st">        </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density.., <span class="dt">fill =</span> ..count..),<span class="dt">binwidth =</span> <span class="dv">5</span>) +<span class="st"> </span>
<span class="st">        </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="dt">fil =</span> <span class="st">&quot;Survived&quot;</span>) +<span class="st"> </span>
<span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(z1, <span class="kw">aes</span>(<span class="dt">x =</span> z1$Age)) +<span class="st"> </span>
<span class="st">        </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density.., <span class="dt">fill =</span> ..count..),<span class="dt">binwidth =</span> <span class="dv">5</span>) +<span class="st"> </span>
<span class="st">        </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="dt">fil =</span> <span class="st">&quot;Survived&quot;</span>) +<span class="st"> </span>
<span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(z2, <span class="kw">aes</span>(<span class="dt">x =</span> z2$Age)) +<span class="st"> </span>
<span class="st">        </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density.., <span class="dt">fill =</span> ..count..),<span class="dt">binwidth =</span> <span class="dv">5</span>) +<span class="st"> </span>
<span class="st">        </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="dt">fil =</span> <span class="st">&quot;Survived&quot;</span>) +<span class="st"> </span>
<span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="kw">multiplot</span>(p1, p2, p3, <span class="dt">cols =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="machinelearningwithR_files/figure-html/titanic_missingdata_pic3-1.png" width="672" /></p>
<p>It does seem like our second method for imputation follow better our first graph. So letâs use that one and input our predicted age into our main dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$Age &lt;-<span class="st"> </span>z2$Age</code></pre></div>
</div>
</div>
<div id="c.-transform-more-feature-engineering-with-the-ages-and-others." class="section level3">
<h3><span class="header-section-number">7.5.2</span> C. Transform More feature engineering with the ages and others.</h3>
<p>Now that we have filled the <code>NA</code> for the age variable. we can massage a bit more that variable.<br />
We can create 3 more variables: Infant from 0 to 5 years old. Child from 5 to 15 years old. Mothers if it is a woman with the variable <code>Parch</code> which is greater than one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$infant &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">if_else</span>(mydata$Age &lt;=<span class="st"> </span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))
mydata$child &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">if_else</span>((mydata$Age &gt;<span class="st"> </span><span class="dv">5</span> &amp;<span class="st"> </span>mydata$Age &lt;<span class="st"> </span><span class="dv">15</span>), <span class="dv">1</span>, <span class="dv">0</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$mother &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">if_else</span>((mydata$Sex ==<span class="st"> &quot;female&quot;</span> &amp;<span class="st"> </span>mydata$Parch !=<span class="st"> </span><span class="dv">0</span>), <span class="dv">1</span>, <span class="dv">0</span>))
mydata$single &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">if_else</span>((mydata$SibSp +<span class="st"> </span>mydata$Parch +<span class="st"> </span><span class="dv">1</span> ==<span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>))</code></pre></div>
</div>
</div>
<div id="references.-1" class="section level2">
<h2><span class="header-section-number">7.6</span> References.</h2>
<ul>
<li>Exploring the titanic dataset from Megan Risdal. <a href="https://www.kaggle.com/mrisdal/titanic/exploring-survival-on-the-titanic">here</a><br />
</li>
<li>The <code>visdat</code> package. <a href="https://github.com/njtierney/visdat">here</a><br />
</li>
<li>The <code>ggmosaic</code> package. <a href="https://github.com/haleyjeppson/ggmosaic">here</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case-study-mushrooms-classification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="final-words.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fderyckel/bookdown-demo/edit/master/15-titanic.Rmd",
"text": "Edit"
},
"download": ["machinelearningwithR.pdf", "machinelearningwithR.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
